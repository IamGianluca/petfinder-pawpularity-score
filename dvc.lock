schema: '2.0'
stages:
  download_data:
    cmd: kaggle competitions download -c petfinder-pawpularity-score -p data/
    outs:
    - path: data/petfinder-pawpularity-score.zip
      md5: 35dd50bacd33ebba746738508e20e276
      size: 1030728211
  unzip_data:
    cmd: unzip data/petfinder-pawpularity-score.zip -d data/
    deps:
    - path: data/petfinder-pawpularity-score.zip
      md5: 35dd50bacd33ebba746738508e20e276
      size: 1030728211
    outs:
    - path: data/sample_submission.csv
      md5: eed5ebc04c54d5e5130a85a4d81dfc6e
      size: 326
    - path: data/test
      md5: e945e75c5c4c977b08ad644851755e27.dir
      size: 83775
      nfiles: 8
    - path: data/test.csv
      md5: 4e4d1b962044457c29f636cc02716e46
      size: 545
    - path: data/train
      md5: 065c7f4be0d67e5175f532982b56cb52.dir
      size: 1039930050
      nfiles: 9912
    - path: data/train.csv
      md5: a7812f42b71d57e77dfc6e05f5cdd865
      size: 594740
  create_folds:
    cmd: python pipe/create_folds.py
    deps:
    - path: data/train.csv
      md5: a7812f42b71d57e77dfc6e05f5cdd865
      size: 594740
    - path: pipe/create_folds.py
      md5: 46d73ee2ebf612b573a916fd679d96f8
      size: 739
    params:
      params.yaml:
        create_folds:
          seed: 6822
          k: 5
    outs:
    - path: data/train_folds.csv
      md5: c2cb6a0cb24be6031baee25b65302691
      size: 614570
  train_one:
    cmd: python pipe/train_one.py
    deps:
    - path: data/train_384
      md5: 9aeba730415ecc750f220fe302acac6a.dir
      size: 234802523
      nfiles: 9912
    - path: data/train_folds.csv
      md5: c2cb6a0cb24be6031baee25b65302691
      size: 614570
    - path: pipe/train_one.py
      md5: 07cf992ae15da6502b2459c2fc39ddb1
      size: 4823
    params:
      params.yaml:
        train_one:
          seed: 46
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_384
          arch: swin_large_patch4_window12_384
          pretrained: true
          epochs: 6
          bs: 8
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: 32
          n_tfms: 2
          magn: 3
          sz: 384
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.0
          loss: bce_with_logits
          opt: adam
          sched: onecycle
          lr: 2.5e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_one_fold0.ckpt
      md5: c0e1a66a2d04505645f539cc91e84790
      size: 2356390618
    - path: ckpts/model_one_fold1.ckpt
      md5: b469a9a02aa1765cd07c982c18690642
      size: 2356390618
    - path: ckpts/model_one_fold2.ckpt
      md5: e2b0d402fec5200c38d81670f38cbd3a
      size: 2356390618
    - path: ckpts/model_one_fold3.ckpt
      md5: ea49ae8421fb334170fceb3c6ef6b315
      size: 2356390618
    - path: ckpts/model_one_fold4.ckpt
      md5: d8503e9cd8c76a9438f664dd402a235b
      size: 2356390618
    - path: metrics/model_one.json
      md5: 0bafcb9b2fed75cfe2283a0c96a0ed80
      size: 46
    - path: preds/model_one_fold0.npy
      md5: a72e7fc220d6997c06e280892a732956
      size: 8060
    - path: preds/model_one_fold1.npy
      md5: b72458b1d6f98759a9d0d77dee4637b0
      size: 8060
    - path: preds/model_one_fold2.npy
      md5: 3e64023ac807f64778425ead025aed6e
      size: 8056
    - path: preds/model_one_fold3.npy
      md5: 4ffe1f3c1a60c7f08cf3c2632bc0115f
      size: 8056
    - path: preds/model_one_fold4.npy
      md5: 0a3d645781d6cd84f586a8a7275e8b53
      size: 8056
  resize_images:
    cmd: python pipe/resize_images.py
    deps:
    - path: data/test
      md5: e945e75c5c4c977b08ad644851755e27.dir
      size: 83775
      nfiles: 8
    - path: data/train
      md5: 065c7f4be0d67e5175f532982b56cb52.dir
      size: 1039930050
      nfiles: 9912
    - path: pipe/resize_images.py
      md5: 22b4e2500eb69a98b5f32cd73384fa8e
      size: 854
    params:
      params.yaml:
        resize:
          sz:
          - 224
          - 384
    outs:
    - path: data/test_224/
      md5: a7ba3be9ceced4ebcaa901c8ece5d971.dir
      size: 11288
      nfiles: 8
    - path: data/test_384/
      md5: 9824472a37c1f99c25c96e7300bb3c35.dir
      size: 23448
      nfiles: 8
    - path: data/train_224/
      md5: 4d3f19867a6f896eb31f001615b86a24.dir
      size: 96860688
      nfiles: 9912
    - path: data/train_384/
      md5: 9aeba730415ecc750f220fe302acac6a.dir
      size: 234802523
      nfiles: 9912
  train_two:
    cmd: python pipe/train_two.py
    deps:
    - path: data/train_224
      md5: 4d3f19867a6f896eb31f001615b86a24.dir
      size: 96860688
      nfiles: 9912
    - path: data/train_folds.csv
      md5: c2cb6a0cb24be6031baee25b65302691
      size: 614570
    - path: pipe/train_two.py
      md5: 7596507288d7135488b262b5cc9046dd
      size: 4823
    params:
      params.yaml:
        train_two:
          seed: 46
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          arch: swin_large_patch4_window7_224
          pretrained: true
          epochs: 6
          bs: 40
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: 32
          n_tfms: 2
          magn: 3
          sz: 224
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.0
          loss: bce_with_logits
          opt: adam
          sched: onecycle
          lr: 0.000125
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_two_fold0.ckpt
      md5: 1184c7cc65272c93d6d013ae7f7e2e21
      size: 2341925914
    - path: ckpts/model_two_fold1.ckpt
      md5: 5e3d8f70868ab4381293d2a8842bcd3f
      size: 2341925914
    - path: ckpts/model_two_fold2.ckpt
      md5: 1da9ada9db5718598a7aab17eac9eff4
      size: 2341925914
    - path: ckpts/model_two_fold3.ckpt
      md5: 706ab4ce17eaa642de4ea906e2cfcd40
      size: 2341925914
    - path: ckpts/model_two_fold4.ckpt
      md5: 982b89dc70b2385c8482fb2ff619e167
      size: 2341925914
    - path: metrics/model_two.json
      md5: 673ffde57ab7c8ebe2c97c134c9ab31c
      size: 45
    - path: preds/model_two_fold0.npy
      md5: a7b736989a2dae05e94bd4aea1c2730b
      size: 8060
    - path: preds/model_two_fold1.npy
      md5: a303d66ec5d5d4590e758381de2e6204
      size: 8060
    - path: preds/model_two_fold2.npy
      md5: eda9b8406b62bdc7d333d7008d54c8f2
      size: 8056
    - path: preds/model_two_fold3.npy
      md5: 236bad20cf869c80b1839b9af3053077
      size: 8056
    - path: preds/model_two_fold4.npy
      md5: 9cd10208d6b2e125b3edca09abbdbaab
      size: 8056
