schema: '2.0'
stages:
  download_data:
    cmd: kaggle competitions download -c petfinder-pawpularity-score -p data/
    outs:
    - path: data/petfinder-pawpularity-score.zip
      md5: 35dd50bacd33ebba746738508e20e276
      size: 1030728211
  unzip_data:
    cmd: unzip data/petfinder-pawpularity-score.zip -d data/
    deps:
    - path: data/petfinder-pawpularity-score.zip
      md5: 35dd50bacd33ebba746738508e20e276
      size: 1030728211
    outs:
    - path: data/sample_submission.csv
      md5: eed5ebc04c54d5e5130a85a4d81dfc6e
      size: 326
    - path: data/test
      md5: e945e75c5c4c977b08ad644851755e27.dir
      size: 83775
      nfiles: 8
    - path: data/test.csv
      md5: 4e4d1b962044457c29f636cc02716e46
      size: 545
    - path: data/train
      md5: 065c7f4be0d67e5175f532982b56cb52.dir
      size: 1039930050
      nfiles: 9912
    - path: data/train.csv
      md5: a7812f42b71d57e77dfc6e05f5cdd865
      size: 594740
  create_folds:
    cmd: python pipe/create_folds.py
    deps:
    - path: data/train_deduped.csv
      md5: a19b722d94bf2f664c9770c4c2e12575
      size: 640790
    - path: pipe/create_folds.py
      md5: 0e2e4da36693df31bd0dafb196f60e77
      size: 1125
    params:
      params.yaml:
        create_folds:
          seed: 42
          k:
          - 5
          - 10
    outs:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
  train_one:
    cmd: python pipe/train_one.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_384
      md5: 3e12f820928b7b6770891beda13b8af2.dir
      size: 236133550
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_one.py
      md5: 61d287719e2280a3ac64aee999a6adb4
      size: 5920
    params:
      params.yaml:
        train_one:
          name: one
          seed: 5899
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_384
          arch: swin_large_patch4_window12_384
          pretrained: true
          epochs: 6
          bs: 16
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: 16
          use_normalize: true
          n_tfms: 2
          magn: 3
          sz: 384
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          lr: 6e-06
          warmup_epochs: 1
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_one_fold0.ckpt
      md5: 457bdc51107293602a5b34a93e2a9b66
      size: 795385889
    - path: ckpts/model_one_fold1.ckpt
      md5: 196661bcfe1665d7b5e07b800be512c7
      size: 795385889
    - path: ckpts/model_one_fold2.ckpt
      md5: 19619e36ed3dbe7a35c179ddbc7c3052
      size: 795385889
    - path: ckpts/model_one_fold3.ckpt
      md5: 98f0b48228e887fa52f57c624a24e7ec
      size: 795385889
    - path: ckpts/model_one_fold4.ckpt
      md5: 96af8e33bfb7f23d140862fec93aa243
      size: 795385889
    - path: metrics/model_one.json
      md5: bbd540db72a2ce3c8e84fc25870adc13
      size: 60
    - path: preds/model_one_oof.npy
      md5: ce21d15ed239169eb83e8447e6a5dc75
      size: 79128
  resize_images:
    cmd: python pipe/resize_images.py
    deps:
    - path: data/test
      md5: e945e75c5c4c977b08ad644851755e27.dir
      size: 83775
      nfiles: 8
    - path: data/train
      md5: 065c7f4be0d67e5175f532982b56cb52.dir
      size: 1039930050
      nfiles: 9912
    - path: pipe/resize_images.py
      md5: 22b4e2500eb69a98b5f32cd73384fa8e
      size: 854
    params:
      params.yaml:
        resize:
          sz:
          - 224
          - 384
    outs:
    - path: data/test_224/
      md5: 8b2b276f61b204b6d52b9d73191cfd83.dir
      size: 170719
      nfiles: 8
    - path: data/test_384/
      md5: ed7b545ec573e12362fca208e03d60a0.dir
      size: 367783
      nfiles: 8
    - path: data/train_224/
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_384/
      md5: 3e12f820928b7b6770891beda13b8af2.dir
      size: 236133550
      nfiles: 9912
  train_two:
    cmd: python pipe/train_two.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_224
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_two.py
      md5: b73dc5f96df975c646796e4d410a02f3
      size: 5920
    params:
      params.yaml:
        train_two:
          name: two
          seed: 7591
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          arch: swin_large_patch4_window7_224
          pretrained: true
          epochs: 6
          bs: 64
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: bf16
          use_normalize: true
          n_tfms: 1
          magn: 5
          sz: 224
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          warmup_epochs: 1
          lr: 2.4e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_two_fold0.ckpt
      md5: 03e6d837cc949f3ead50e2cb3aab13f6
      size: 782545633
    - path: ckpts/model_two_fold1.ckpt
      md5: e863e524768c84100a16473608517d8a
      size: 782545633
    - path: ckpts/model_two_fold2.ckpt
      md5: 4ddf818c4d8fb1e55ac8bbb5b09d0ed8
      size: 782545633
    - path: ckpts/model_two_fold3.ckpt
      md5: d8ad999fc086cb4e74bfa6e369c5b54f
      size: 782545633
    - path: ckpts/model_two_fold4.ckpt
      md5: 7e3027ecc673bfa60364d8729a157406
      size: 782545633
    - path: metrics/model_two.json
      md5: 94c436d7599acc83d071200d4bdbfdd6
      size: 61
    - path: preds/model_two_oof.npy
      md5: 1e37edfce0dbfad147f2b366196b3a33
      size: 79128
  remove_duplicates:
    cmd: python pipe/remove_duplicate_images.py
    deps:
    - path: data/train
      md5: 065c7f4be0d67e5175f532982b56cb52.dir
      size: 1039930050
      nfiles: 9912
    - path: pipe/remove_duplicate_images.py
      md5: 6e6f526909266d3a1af7af13c985a3cd
      size: 3931
    outs:
    - path: data/train_deduped.csv
      md5: a19b722d94bf2f664c9770c4c2e12575
      size: 640790
  train_three:
    cmd: python pipe/train_three.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_224
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_three.py
      md5: d8f8dfd6a0fcd35b5579381f27f1ccc0
      size: 5922
    params:
      params.yaml:
        train_three:
          name: three
          seed: 9102
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          arch: xcit_large_24_p8_224_dist
          pretrained: true
          epochs: 6
          bs: 16
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: bf16
          use_normalize: true
          n_tfms: 1
          magn: 5
          sz: 224
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          warmup_epochs: 1
          lr: 1e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_three_fold0.ckpt
      md5: 553b32cce751766f063a3d9db0c31d42
      size: 753522607
    - path: ckpts/model_three_fold1.ckpt
      md5: 801d8c13d68d955eac58746ee8350dc5
      size: 753522607
    - path: ckpts/model_three_fold2.ckpt
      md5: 588a8433a3901beb0fafff826a70c0be
      size: 753522607
    - path: ckpts/model_three_fold3.ckpt
      md5: f65b0e3204fb2b2e39994f475ee11afa
      size: 753522607
    - path: ckpts/model_three_fold4.ckpt
      md5: 44ce955b0b601a60c9cfaf6d5506e48a
      size: 753522607
    - path: metrics/model_three.json
      md5: 2f21dbf633ce1e4c218ea83a83504199
      size: 60
    - path: preds/model_three_oof.npy
      md5: 774b89411389c42868c96f1029808c74
      size: 79128
  train_four:
    cmd: python pipe/train_four.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_224
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_four.py
      md5: 544d5890913a1a023b2eaf338f81f822
      size: 5921
    params:
      params.yaml:
        train_four:
          name: four
          seed: 1230
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          arch: cait_s24_224
          pretrained: true
          epochs: 6
          bs: 64
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: bf16
          use_normalize: true
          n_tfms: 1
          magn: 5
          sz: 224
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          warmup_epochs: 1
          lr: 4e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_four_fold0.ckpt
      md5: ff4ea117e926dd2f087da5caa2186350
      size: 186554817
    - path: ckpts/model_four_fold1.ckpt
      md5: 7bb72edc5571454c51df8fe0dda5ee2a
      size: 186554817
    - path: ckpts/model_four_fold2.ckpt
      md5: 297a7ba42db9de8ccc80c9dc9e1dde1d
      size: 186554817
    - path: ckpts/model_four_fold3.ckpt
      md5: e7a27a6020317fd3e71d16a521089b92
      size: 186554817
    - path: ckpts/model_four_fold4.ckpt
      md5: b1926f67194ff5eed876256c5728ecdb
      size: 186554817
    - path: metrics/model_four.json
      md5: 97ee81cc88c8c1ea605ea0531d09d951
      size: 62
    - path: preds/model_four_oof.npy
      md5: 6f2757ecc85fb79286fb4d5ecf9f3c2a
      size: 79128
  ensemble:
    cmd: python pipe/ensemble.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/ensemble.py
      md5: eb17b3e9f66790fa0a705dc9c0d89d32
      size: 1779
    - path: preds/model_four_oof.npy
      md5: 6f2757ecc85fb79286fb4d5ecf9f3c2a
      size: 79128
    - path: preds/model_one_oof.npy
      md5: ce21d15ed239169eb83e8447e6a5dc75
      size: 79128
    - path: preds/model_three_oof.npy
      md5: 774b89411389c42868c96f1029808c74
      size: 79128
    - path: preds/model_two_oof.npy
      md5: 1e37edfce0dbfad147f2b366196b3a33
      size: 79128
    params:
      params.yaml:
        ensemble:
          name: ensemble
          seed: 1616
          models:
          - one
          - two
          - three
          - four
          n_folds: 5
    outs:
    - path: ckpts/model_ensemble.joblib
      md5: d779c73f3ef685b2fae9d3730e903688
      size: 84831
    - path: metrics/model_ensemble.json
      md5: 39fbac63821cb8ee23b039ad5e082fea
      size: 22
  download_extra_data:
    cmd: kaggle competitions download -c petfinder-adoption-prediction -p data/petfinder-adoption-prediction
    outs:
    - path: data/petfinder-adoption-prediction/petfinder-adoption-prediction.zip
      md5: f5d570d05f001c7111ae9d296a776de5
      size: 2083562071
  unzip_extra_data:
    cmd: unzip data/petfinder-adoption-prediction/petfinder-adoption-prediction.zip
      -d data/petfinder-adoption-prediction/
    deps:
    - path: data/petfinder-adoption-prediction/petfinder-adoption-prediction.zip
      md5: f5d570d05f001c7111ae9d296a776de5
      size: 2083562071
    outs:
    - path: data/petfinder-adoption-prediction/BreedLabels.csv
      md5: 2d77f05b9a5f400a879aed75761f2d5c
      size: 6984
    - path: data/petfinder-adoption-prediction/ColorLabels.csv
      md5: 6aa37b90b49305f686b2cf48c41e63a6
      size: 88
    - path: data/petfinder-adoption-prediction/PetFinder-BreedLabels.csv
      md5: 2d77f05b9a5f400a879aed75761f2d5c
      size: 6984
    - path: data/petfinder-adoption-prediction/PetFinder-ColorLabels.csv
      md5: 6aa37b90b49305f686b2cf48c41e63a6
      size: 88
    - path: data/petfinder-adoption-prediction/PetFinder-StateLabels.csv
      md5: 8f325ebd539d5f4d8919c629b11cb88a
      size: 285
    - path: data/petfinder-adoption-prediction/StateLabels.csv
      md5: 8f325ebd539d5f4d8919c629b11cb88a
      size: 285
    - path: data/petfinder-adoption-prediction/breed_labels.csv
      md5: 2d77f05b9a5f400a879aed75761f2d5c
      size: 6984
    - path: data/petfinder-adoption-prediction/color_labels.csv
      md5: 6aa37b90b49305f686b2cf48c41e63a6
      size: 88
    - path: data/petfinder-adoption-prediction/state_labels.csv
      md5: 8f325ebd539d5f4d8919c629b11cb88a
      size: 285
    - path: data/petfinder-adoption-prediction/test/
      md5: 7fd247dc9d00279a2c918e80f8115982.dir
      size: 1694948
      nfiles: 2
    - path: data/petfinder-adoption-prediction/test_images
      md5: a867212f5caaeff7bb4dff513163e931.dir
      size: 391972706
      nfiles: 14465
    - path: data/petfinder-adoption-prediction/test_metadata
      md5: 90581d235d3a0ab63a5487279e5f02e6.dir
      size: 77217658
      nfiles: 14465
    - path: data/petfinder-adoption-prediction/test_sentiment
      md5: db4e84200e60f820144b7e382c673b01.dir
      size: 16509699
      nfiles: 3865
    - path: data/petfinder-adoption-prediction/train/
      md5: 503cab2cc4c5476ed3d3773ea5d69305.dir
      size: 6690166
      nfiles: 1
    - path: data/petfinder-adoption-prediction/train_images/
      md5: 4f5d52211e133269efb0582221b681f6.dir
      size: 1606122052
      nfiles: 58311
    - path: data/petfinder-adoption-prediction/train_metadata
      md5: bd1bbcad90f59319dc3ac4efb7e9d0fb.dir
      size: 312766464
      nfiles: 58311
    - path: data/petfinder-adoption-prediction/train_sentiment
      md5: eec2b1030c8c10a84c4c5f1a979a394a.dir
      size: 67574427
      nfiles: 14442
  organize_extra_images:
    cmd: mkdir data/extra && find data/petfinder-adoption-prediction/ -name '*.jpg'
      -exec cp {} data/extra/ \;
    deps:
    - path: data/petfinder-adoption-prediction/test_images/
      md5: a867212f5caaeff7bb4dff513163e931.dir
      size: 391972706
      nfiles: 14465
    - path: data/petfinder-adoption-prediction/train_images/
      md5: 4f5d52211e133269efb0582221b681f6.dir
      size: 1606122052
      nfiles: 58311
    outs:
    - path: data/extra
      md5: ab4e24fc3d00c4345d86a2647e55685b.dir
      size: 1998094758
      nfiles: 72776
  resize_extra_images:
    cmd: python pipe/resize_extra_images.py
    deps:
    - path: data/extra/
      md5: ab4e24fc3d00c4345d86a2647e55685b.dir
      size: 1998094758
      nfiles: 72776
    - path: pipe/resize_extra_images.py
      md5: c336f6f4210ea3cb50f3a0308675cb97
      size: 824
    params:
      params.yaml:
        resize_extra_images:
          sz:
          - 224
          - 384
    outs:
    - path: data/extra_224
      md5: 38167aa44a98fa7a2b33a53c2665327b.dir
      size: 694454778
      nfiles: 72776
    - path: data/extra_384
      md5: f0d0d79586659ba82df50d4314effbc2.dir
      size: 1109231399
      nfiles: 72776
  pseudo_labeling:
    cmd: python pipe/pseudo_label.py
    deps:
    - path: ckpts/model_four_fold0.ckpt
      md5: ff4ea117e926dd2f087da5caa2186350
      size: 186554817
    - path: ckpts/model_four_fold1.ckpt
      md5: 7bb72edc5571454c51df8fe0dda5ee2a
      size: 186554817
    - path: ckpts/model_four_fold2.ckpt
      md5: 297a7ba42db9de8ccc80c9dc9e1dde1d
      size: 186554817
    - path: ckpts/model_four_fold3.ckpt
      md5: e7a27a6020317fd3e71d16a521089b92
      size: 186554817
    - path: ckpts/model_four_fold4.ckpt
      md5: b1926f67194ff5eed876256c5728ecdb
      size: 186554817
    - path: ckpts/model_one_fold0.ckpt
      md5: 457bdc51107293602a5b34a93e2a9b66
      size: 795385889
    - path: ckpts/model_one_fold1.ckpt
      md5: 196661bcfe1665d7b5e07b800be512c7
      size: 795385889
    - path: ckpts/model_one_fold2.ckpt
      md5: 19619e36ed3dbe7a35c179ddbc7c3052
      size: 795385889
    - path: ckpts/model_one_fold3.ckpt
      md5: 98f0b48228e887fa52f57c624a24e7ec
      size: 795385889
    - path: ckpts/model_one_fold4.ckpt
      md5: 96af8e33bfb7f23d140862fec93aa243
      size: 795385889
    - path: ckpts/model_three_fold0.ckpt
      md5: 553b32cce751766f063a3d9db0c31d42
      size: 753522607
    - path: ckpts/model_three_fold1.ckpt
      md5: 801d8c13d68d955eac58746ee8350dc5
      size: 753522607
    - path: ckpts/model_three_fold2.ckpt
      md5: 588a8433a3901beb0fafff826a70c0be
      size: 753522607
    - path: ckpts/model_three_fold3.ckpt
      md5: f65b0e3204fb2b2e39994f475ee11afa
      size: 753522607
    - path: ckpts/model_three_fold4.ckpt
      md5: 44ce955b0b601a60c9cfaf6d5506e48a
      size: 753522607
    - path: ckpts/model_two_fold0.ckpt
      md5: 03e6d837cc949f3ead50e2cb3aab13f6
      size: 782545633
    - path: ckpts/model_two_fold1.ckpt
      md5: e863e524768c84100a16473608517d8a
      size: 782545633
    - path: ckpts/model_two_fold2.ckpt
      md5: 4ddf818c4d8fb1e55ac8bbb5b09d0ed8
      size: 782545633
    - path: ckpts/model_two_fold3.ckpt
      md5: d8ad999fc086cb4e74bfa6e369c5b54f
      size: 782545633
    - path: ckpts/model_two_fold4.ckpt
      md5: 7e3027ecc673bfa60364d8729a157406
      size: 782545633
    - path: data/extra_224/
      md5: 38167aa44a98fa7a2b33a53c2665327b.dir
      size: 694454778
      nfiles: 72776
    - path: data/extra_384/
      md5: f0d0d79586659ba82df50d4314effbc2.dir
      size: 1109231399
      nfiles: 72776
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/pseudo_label.py
      md5: 49a2081c5a835a97f1dfe9896382fbcf
      size: 2681
    params:
      params.yaml:
        pseudo_labeling:
          models:
          - one
          - two
          - three
          - four
          n_folds: 5
    outs:
    - path: data/extra.csv
      md5: ef9d301bed7a5196c89dd5d843c4d241
      size: 21545825
  train_four_extra:
    cmd: python pipe/train_four_extra.py
    deps:
    - path: data/extra.csv
      md5: ef9d301bed7a5196c89dd5d843c4d241
      size: 21545825
    - path: data/extra_224
      md5: 38167aa44a98fa7a2b33a53c2665327b.dir
      size: 694454778
      nfiles: 72776
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_224
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_four_extra.py
      md5: 4aa7b633afef1a700d688e44dc604a82
      size: 5998
    params:
      params.yaml:
        train_four_extra:
          name: four_extra
          seed: 1230
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          use_extra_images: true
          arch: cait_s24_224
          pretrained: true
          epochs: 6
          bs: 64
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: bf16
          use_normalize: true
          n_tfms: 1
          magn: 5
          sz: 224
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          warmup_epochs: 1
          lr: 4e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_four_extra_fold0.ckpt
      md5: 9a4d43b14cbfeb0df7925146b03f8241
      size: 186575105
    - path: ckpts/model_four_extra_fold1.ckpt
      md5: f86da33bad72f5bc575855eccdedcd91
      size: 186575105
    - path: ckpts/model_four_extra_fold2.ckpt
      md5: 078f61800ade0cb717bebaf1b1633f91
      size: 186575105
    - path: ckpts/model_four_extra_fold3.ckpt
      md5: 1bc99151eed2553adeb8c470f72b4156
      size: 186575105
    - path: ckpts/model_four_extra_fold4.ckpt
      md5: ac40bc6201fe782b21edc8ba92ea1f77
      size: 186575105
    - path: metrics/model_four_extra.json
      md5: 2ead0ba976708030a2f745fae0f903f8
      size: 62
    - path: preds/model_four_extra_oof.npy
      md5: dbd7de6455ecb8e7cd4ab8295e19c8ec
      size: 79128
  train_two_extra:
    cmd: python pipe/train_two_extra.py
    deps:
    - path: data/extra.csv
      md5: ef9d301bed7a5196c89dd5d843c4d241
      size: 21545825
    - path: data/extra_224
      md5: 38167aa44a98fa7a2b33a53c2665327b.dir
      size: 694454778
      nfiles: 72776
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_224
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_two_extra.py
      md5: cb81887bad9f6e0f1ffc7802cd1b5d1b
      size: 5983
    params:
      params.yaml:
        train_two_extra:
          name: two_extra
          seed: 7591
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          use_extra_images: true
          arch: swin_large_patch4_window7_224
          pretrained: true
          epochs: 6
          bs: 64
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: bf16
          use_normalize: true
          n_tfms: 1
          magn: 5
          sz: 224
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          warmup_epochs: 1
          lr: 2.4e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_two_extra_fold0.ckpt
      md5: 811992104ee25de2b720acac41df190e
      size: 782566241
    - path: ckpts/model_two_extra_fold1.ckpt
      md5: 0293becf0917ff64d9bd9434db6fc517
      size: 782566241
    - path: ckpts/model_two_extra_fold2.ckpt
      md5: d8bd8c9575b4c42d9004fd8375d934a7
      size: 782566241
    - path: ckpts/model_two_extra_fold3.ckpt
      md5: ce3df838384fa86c41076f860905b66e
      size: 782566241
    - path: ckpts/model_two_extra_fold4.ckpt
      md5: 14b462600f8c5f05b1ac2ba360fb0df6
      size: 782566241
    - path: metrics/model_two_extra.json
      md5: a6729a7c2a5b23986adcf2da4446c9ee
      size: 62
    - path: preds/model_two_extra_oof.npy
      md5: 10f8da6dcff6789f0ca2586a611cd0b0
      size: 79128
  train_one_extra:
    cmd: python pipe/train_one_extra.py
    deps:
    - path: data/extra.csv
      md5: ef9d301bed7a5196c89dd5d843c4d241
      size: 21545825
    - path: data/extra_384
      md5: f0d0d79586659ba82df50d4314effbc2.dir
      size: 1109231399
      nfiles: 72776
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_384
      md5: 3e12f820928b7b6770891beda13b8af2.dir
      size: 236133550
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_one_extra.py
      md5: ecccbb75d198ccb5953566c081ea4ab3
      size: 5983
    params:
      params.yaml:
        train_one_extra:
          name: one_extra
          seed: 6921
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_384
          use_extra_images: true
          arch: swin_large_patch4_window12_384
          pretrained: true
          epochs: 6
          bs: 16
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: 16
          use_normalize: true
          n_tfms: 2
          magn: 3
          sz: 384
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          lr: 6e-06
          warmup_epochs: 1
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_one_extra_fold0.ckpt
      md5: b373e2e62ca2b4ad591b274b43a87bb8
      size: 795406497
    - path: ckpts/model_one_extra_fold1.ckpt
      md5: cce86c58dfd5458f950e4c0dd96726e1
      size: 795406497
    - path: ckpts/model_one_extra_fold2.ckpt
      md5: c37525508e5b3f7a82745d823631adf2
      size: 795406497
    - path: ckpts/model_one_extra_fold3.ckpt
      md5: 6159735b7e53daa7ec00fd5aadb5072f
      size: 795406497
    - path: ckpts/model_one_extra_fold4.ckpt
      md5: 83c235f25975bd541438fe12da52f641
      size: 795406497
    - path: metrics/model_one_extra.json
      md5: 2e73016372f4670b55cc32cf7479460b
      size: 62
    - path: preds/model_one_extra_oof.npy
      md5: df13fcdb94b31bf9ec68ff1379d8912c
      size: 79128
  ensemble_extra:
    cmd: python pipe/ensemble_extra.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/ensemble_extra.py
      md5: 39a9edded2adf0e4be9b8c3e8a571e88
      size: 1295
    - path: preds/model_four_extra_oof.npy
      md5: a9c1b57136384300ce66a5c37c501e63
      size: 79128
    - path: preds/model_one_extra_oof.npy
      md5: f042ca02bd3d436ab13f961b063007b4
      size: 79128
    - path: preds/model_two_extra_oof.npy
      md5: 0e4aed187ef25562438f323d3c178a5d
      size: 79128
    params:
      params.yaml:
        ensemble_extra:
          models:
          - one_extra
          - two_extra
          - four_extra
          n_folds: 5
    outs:
    - path: metrics/ensemble_extra.json
      md5: c70880fe4dff1771680d10145343bc05
      size: 22
  ensemble_final:
    cmd: python pipe/ensemble_final.py
    deps:
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/ensemble_final.py
      md5: 53a155a8e955c654a35fc29e33b893a9
      size: 2659
    - path: preds/model_four_extra_oof.npy
      md5: dbd7de6455ecb8e7cd4ab8295e19c8ec
      size: 79128
    - path: preds/model_one_extra_oof.npy
      md5: df13fcdb94b31bf9ec68ff1379d8912c
      size: 79128
    - path: preds/model_three_extra_oof.npy
      md5: 0ea9159f685898fa21429e555084fb24
      size: 79128
    - path: preds/model_two_extra_oof.npy
      md5: 10f8da6dcff6789f0ca2586a611cd0b0
      size: 79128
    params:
      params.yaml:
        ensemble_final:
          name: ensemble_final
          seed: 1010
          n_folds: 5
          models:
          - one
          - two
          - three
          - four
          - one_extra
          - two_extra
          - three_extra
          - four_extra
    outs:
    - path: ckpts/model_ensemble_final.joblib
      md5: 79e24c7009fcc88fc3d4e42e992eaf54
      size: 84959
    - path: metrics/model_ensemble_final.json
      md5: 78d1680d84fd573603df31b3a867f7c9
      size: 21
  train_three_extra:
    cmd: python pipe/train_three_extra.py
    deps:
    - path: data/extra.csv
      md5: ef9d301bed7a5196c89dd5d843c4d241
      size: 21545825
    - path: data/extra_224
      md5: 38167aa44a98fa7a2b33a53c2665327b.dir
      size: 694454778
      nfiles: 72776
    - path: data/train_10folds.csv
      md5: 2e136ecbf70718f80898b57cbd7fe878
      size: 660556
    - path: data/train_224
      md5: 3452a5af5bd28029d534ec33b0bd09f4.dir
      size: 97308155
      nfiles: 9912
    - path: data/train_5folds.csv
      md5: df60fb7c97941742af389960321d6f97
      size: 660556
    - path: pipe/train_three_extra.py
      md5: bbc9ae7e376a212327e947a7de5d32eb
      size: 5999
    params:
      params.yaml:
        train_three_extra:
          name: three_extra
          seed: 9102
          n_folds: 5
          fold: -1
          metric: rmse
          metric_mode: min
          train_data: data/train_224
          use_extra_images: true
          arch: xcit_large_24_p8_224_dist
          pretrained: true
          epochs: 6
          bs: 16
          auto_batch_size: false
          accumulate_grad_batches: 1
          precision: bf16
          use_normalize: true
          n_tfms: 1
          magn: 5
          sz: 224
          use_mix: 0
          mix_p: 0.0
          resize: -1
          dropout: 0.0
          wd: 0.0
          label_smoothing: 0.1
          loss: bce_with_logits
          opt: adamw
          sched: cosine
          warmup_epochs: 1
          lr: 1e-05
          auto_lr: false
          mom: 0.9
    outs:
    - path: ckpts/model_three_extra_fold0.ckpt
      md5: adda90af98d59d804d02704f4e6e7749
      size: 753548335
    - path: ckpts/model_three_extra_fold1.ckpt
      md5: ccaef2c0269e1bfc84ea624daa0a788c
      size: 753548335
    - path: ckpts/model_three_extra_fold2.ckpt
      md5: 171282fade81c03812c8e86a5e4ce934
      size: 753548335
    - path: ckpts/model_three_extra_fold3.ckpt
      md5: abc8a6d4423d370d4b9d6258c9fbb6ee
      size: 753548335
    - path: ckpts/model_three_extra_fold4.ckpt
      md5: 64e055700f0697b22a9587f7c3a7ff2d
      size: 753548335
    - path: metrics/model_three_extra.json
      md5: f57b75df54717eae491a415e38d1363b
      size: 62
    - path: preds/model_three_extra_oof.npy
      md5: 0ea9159f685898fa21429e555084fb24
      size: 79128
